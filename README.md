# Fitness & Nutrition Hub

Tu hub personal para entrenamiento, nutrici√≥n y automatizaciones. Una aplicaci√≥n completa construida con Next.js 14, Supabase y n8n para gestionar tu fitness y nutrici√≥n de manera inteligente.

## üöÄ Caracter√≠sticas

### ‚úÖ Funcionalidades Principales
- **Autenticaci√≥n**: Email/contrase√±a y Google OAuth
- **Dashboard "Hoy"**: Vista del d√≠a actual con progreso de macros y comidas planificadas
- **Plan Semanal**: Vista de 7 d√≠as con distinci√≥n entre d√≠as de entrenamiento y descanso
- **Gesti√≥n de Comidas**: CRUD de plantillas y alimentos
- **Gesti√≥n de Entrenos**: CRUD de rutinas y ejercicios con tipos (Gimnasio/Boxeo)
- **Chatbot de Nutrici√≥n**: An√°lisis de macros mediante IA para comidas no predefinidas
- **Seguimiento de Macros**: C√°lculo autom√°tico de calor√≠as, prote√≠nas, carbohidratos y grasas
- **Ajustes Personalizados**: Metas nutricionales y configuraci√≥n de zona horaria

### ü§ñ Automatizaciones (n8n)
- **Generaci√≥n Semanal**: Crea autom√°ticamente el plan de la semana cada domingo a las 20:00
- **Recordatorios de Comidas**: Notificaciones cada 15 minutos para comidas pr√≥ximas
- **An√°lisis de Macros**: Chatbot inteligente para analizar comidas y extraer macros
- **Integraci√≥n Telegram**: Notificaciones y botones interactivos

### üì± Dise√±o Responsivo
- Mobile-first design con Tailwind CSS
- Navegaci√≥n optimizada para m√≥vil
- Tablas responsive con overflow horizontal

## üõ†Ô∏è Stack Tecnol√≥gico

- **Frontend**: Next.js 14 (App Router) + TypeScript
- **UI**: Tailwind CSS + shadcn/ui
- **Base de Datos**: Supabase PostgreSQL con RLS
- **Autenticaci√≥n**: Supabase Auth
- **Validaci√≥n**: Zod
- **Fechas**: date-fns con zona horaria Europe/Madrid
- **Automatizaciones**: n8n (self-hosted o cloud)
- **Notificaciones**: Telegram Bot API

## üìã Requisitos Previos

- Node.js 18+ 
- npm (no yarn)
- Cuenta de Supabase
- Cuenta de n8n (opcional para automatizaciones)
- Bot de Telegram (opcional para notificaciones)

## üöÄ Instalaci√≥n y Configuraci√≥n

### 1. Clonar y Instalar Dependencias

```bash
# Clonar el repositorio
git clone <repository-url>
cd fitness-nutrition-hub

# Instalar dependencias
npm install
```

### 2. Configurar Supabase

1. **Crear proyecto en Supabase**:
   - Ve a [supabase.com](https://supabase.com)
   - Crea un nuevo proyecto
   - Guarda la URL y las claves

2. **Configurar autenticaci√≥n**:
   - En Authentication > Settings > Auth Providers
   - Habilita Email y Google OAuth
   - Para Google OAuth, configura las credenciales en Google Cloud Console

3. **Importar esquema de base de datos**:
   ```bash
   # En el SQL Editor de Supabase, ejecuta:
   # 1. database/schema.sql (esquema completo)
   # 2. database/seed.sql (datos de ejemplo)
   ```

### 3. Configurar Variables de Entorno

```bash
# Copiar archivo de ejemplo
cp env.example .env.local

# Editar .env.local con tus valores
```

**Variables requeridas**:
```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=tu_url_de_supabase
NEXT_PUBLIC_SUPABASE_ANON_KEY=tu_clave_anonima
SUPABASE_SERVICE_ROLE_KEY=tu_clave_service_role

# Next.js
NEXTAUTH_SECRET=tu_secret_aleatorio
NEXTAUTH_URL=http://localhost:3000
```

**Variables opcionales** (para automatizaciones):
```env
# n8n
BASE_URL=http://localhost:3000
API_TOKEN=token_para_n8n
DEFAULT_TEMPLATE_ID=id_de_plantilla_por_defecto

# Telegram
TELEGRAM_BOT_TOKEN=token_del_bot
TELEGRAM_CHAT_ID=tu_chat_id
```

### 4. Ejecutar en Desarrollo

```bash
# Ejecutar en modo desarrollo
npm run dev

# Abrir http://localhost:3000
```

### 5. Configurar n8n (Opcional)

1. **Instalar n8n**:
   ```bash
   # Con Docker
   docker run -it --rm \
     --name n8n \
     -p 5678:5678 \
     -v ~/.n8n:/home/node/.n8n \
     n8nio/n8n
   ```

2. **Importar workflows**:
   - Abre n8n en http://localhost:5678
   - Importa los archivos de `n8n-workflows/`
   - Configura las variables de entorno en n8n

3. **Configurar variables en n8n**:
   - `BASE_URL`: URL de tu aplicaci√≥n
   - `API_TOKEN`: Token para autenticaci√≥n
   - `TELEGRAM_BOT_TOKEN`: Token del bot de Telegram
   - `TELEGRAM_CHAT_ID`: Tu chat ID de Telegram

## üìä Estructura del Proyecto

```
fitness-nutrition-hub/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (app)/                    # Rutas protegidas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ today/               # Dashboard "Hoy"
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plan/                # Plan semanal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comidas/             # Gesti√≥n de comidas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entrenos/            # Gesti√≥n de entrenos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ajustes/             # Configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ api/                     # API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health/              # Health check
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plans/               # Gesti√≥n de planes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hooks/               # Webhooks
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx               # Layout principal
‚îú‚îÄ‚îÄ components/                   # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ ui/                      # Componentes de UI
‚îÇ   ‚îú‚îÄ‚îÄ layout/                  # Layout components
‚îÇ   ‚îú‚îÄ‚îÄ nutrition/               # Componentes de nutrici√≥n
‚îÇ   ‚îî‚îÄ‚îÄ providers/               # Providers de contexto
‚îú‚îÄ‚îÄ lib/                         # Utilidades y configuraciones
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts             # Cliente de Supabase
‚îÇ   ‚îú‚îÄ‚îÄ utils.ts                # Funciones utilitarias
‚îÇ   ‚îî‚îÄ‚îÄ validations.ts          # Esquemas de validaci√≥n
‚îú‚îÄ‚îÄ database/                    # Esquemas de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql              # Esquema completo
‚îÇ   ‚îî‚îÄ‚îÄ seed.sql                # Datos de ejemplo
‚îú‚îÄ‚îÄ n8n-workflows/              # Workflows de automatizaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ generate-week.json      # Generaci√≥n semanal
‚îÇ   ‚îî‚îÄ‚îÄ meal-reminders.json     # Recordatorios de comidas
‚îî‚îÄ‚îÄ types/                      # Tipos de TypeScript
    ‚îî‚îÄ‚îÄ supabase.ts             # Tipos de Supabase
```

## üóÑÔ∏è Esquema de Base de Datos

### Tablas Principales

- **users**: Perfiles de usuario
- **goals**: Metas nutricionales por usuario
- **foods**: Base de datos de alimentos
- **meal_templates**: Plantillas de comidas
- **day_plans**: Planes diarios
- **day_plan_items**: Items de comidas del d√≠a
- **workouts**: Rutinas de entrenamiento
- **exercises**: Ejercicios disponibles
- **schedule**: Programaci√≥n de entrenos
- **logs_meals**: Registro de comidas consumidas

### Seguridad (RLS)

Todas las tablas tienen Row Level Security (RLS) habilitado:
- Los usuarios solo pueden acceder a sus propios datos
- Las tablas `foods` y `exercises` son de solo lectura para usuarios autenticados
- Pol√≠ticas autom√°ticas basadas en `auth.uid()`

## üîß API Endpoints

### Autenticaci√≥n
- `POST /api/auth/signup` - Registro de usuario
- `POST /api/auth/signin` - Inicio de sesi√≥n

### Planes
- `GET /api/plans/today` - Obtener plan del d√≠a actual
- `POST /api/plans/create` - Crear plan del d√≠a
- `PUT /api/plans/:id` - Actualizar plan

### Comidas
- `POST /api/hooks/meal-done` - Marcar comida como hecha
- `GET /api/meals/templates` - Obtener plantillas
- `POST /api/meals/templates` - Crear plantilla

### Chatbot
- `POST /api/chatbot/analyze` - An√°lisis de macros de comidas

### Health Check
- `GET /api/health` - Estado de la aplicaci√≥n

## ü§ñ Automatizaciones con n8n

### Workflow 1: Generaci√≥n Semanal
- **Trigger**: Cada domingo a las 20:00
- **Acci√≥n**: Crea planes para toda la semana
- **Notificaci√≥n**: Resumen por Telegram

### Workflow 2: Recordatorios de Comidas
- **Trigger**: Cada 15 minutos
- **Acci√≥n**: Verifica comidas pr√≥ximas
- **Notificaci√≥n**: Recordatorio con bot√≥n "Marcar hecho"

### Workflow 3: An√°lisis de Macros (Chatbot)
- **Trigger**: Webhook desde la aplicaci√≥n
- **Acci√≥n**: Analiza descripci√≥n de comida y extrae macros
- **Respuesta**: Devuelve macros calculados y sugiere guardar alimento

## üì± Uso de la Aplicaci√≥n

### 1. Registro e Inicio de Sesi√≥n
- Registra una cuenta con email o usa Google OAuth
- Configura tus metas nutricionales en Ajustes

### 2. Configurar Metas
- Ve a Ajustes > Metas Nutricionales
- Establece tus objetivos de calor√≠as y macros
- Configura tu zona horaria

### 3. Crear Plantillas de Comidas
- Ve a Comidas > Plantillas
- Crea plantillas reutilizables con alimentos y cantidades

### 4. Planificar la Semana
- Ve a Plan para ver la semana completa
- Marca d√≠as de entrenamiento vs descanso
- Aplica plantillas a d√≠as espec√≠ficos

### 5. An√°lisis de Comidas con Chatbot
- Ve a Chatbot para analizar comidas no predefinidas
- Describe tu comida (ej: "Com√≠ una manzana de 150g")
- Guarda nuevos alimentos en la base de datos

### 6. Seguimiento Diario
- Ve a Hoy para ver el progreso del d√≠a
- Marca comidas como hechas
- Visualiza macros restantes

## üöÄ Despliegue

### Vercel (Recomendado)

1. **Conectar repositorio**:
   ```bash
   # Instalar Vercel CLI
   npm i -g vercel

   # Desplegar
   vercel
   ```

2. **Configurar variables de entorno** en Vercel Dashboard

3. **Configurar dominio personalizado** (opcional)

### Variables de Entorno en Producci√≥n

```env
NEXT_PUBLIC_SUPABASE_URL=https://tu-proyecto.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=tu_clave_anonima
SUPABASE_SERVICE_ROLE_KEY=tu_clave_service_role
NEXTAUTH_SECRET=secret_aleatorio_largo
NEXTAUTH_URL=https://tu-dominio.com
```

## üß™ Testing

```bash
# Ejecutar tests
npm test

# Tests en modo watch
npm run test:watch
```

## üìà Monitoreo y Logs

### Supabase
- Dashboard de Supabase para monitorear base de datos
- Logs de autenticaci√≥n y consultas

### Vercel
- Analytics y m√©tricas de rendimiento
- Logs de funciones serverless

### n8n
- Dashboard de n8n para monitorear workflows
- Logs de ejecuci√≥n de automatizaciones

## üîí Seguridad

### Implementado
- ‚úÖ Row Level Security (RLS) en Supabase
- ‚úÖ Autenticaci√≥n con Supabase Auth
- ‚úÖ Validaci√≥n con Zod en todos los endpoints
- ‚úÖ CORS configurado
- ‚úÖ Variables de entorno seguras

### Recomendaciones
- üîÑ Rotar claves de API regularmente
- üîÑ Monitorear logs de autenticaci√≥n
- üîÑ Usar HTTPS en producci√≥n
- üîÑ Implementar rate limiting

## üêõ Troubleshooting

### Problemas Comunes

1. **Error de autenticaci√≥n**:
   - Verifica las claves de Supabase
   - Confirma que el dominio est√© en la lista blanca

2. **Error de base de datos**:
   - Ejecuta el esquema SQL completo
   - Verifica las pol√≠ticas RLS

3. **n8n no funciona**:
   - Verifica las variables de entorno
   - Confirma que la API est√© accesible

4. **Telegram no env√≠a mensajes**:
   - Verifica el token del bot
   - Confirma el chat ID

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

## üÜò Soporte

- **Issues**: Usa GitHub Issues para reportar bugs
- **Discussions**: Usa GitHub Discussions para preguntas
- **Documentaci√≥n**: Consulta este README y los comentarios en el c√≥digo

## üéØ Roadmap

### Pr√≥ximas Funcionalidades
- [ ] App m√≥vil con React Native
- [ ] Integraci√≥n con wearables (Apple Watch, Fitbit)
- [ ] IA para sugerencias de comidas
- [ ] An√°lisis avanzado de progreso
- [ ] Integraci√≥n con MyFitnessPal
- [ ] Modo offline
- [ ] Exportaci√≥n de datos
- [ ] M√∫ltiples idiomas

### Mejoras T√©cnicas
- [ ] PWA (Progressive Web App)
- [ ] Cache inteligente
- [ ] Optimizaci√≥n de im√°genes
- [ ] Tests E2E con Playwright
- [ ] CI/CD mejorado

---

**¬°Disfruta tu Fitness & Nutrition Hub! üí™ü•ó**
